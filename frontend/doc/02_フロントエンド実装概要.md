# フロントエンド実装概要

リアルタイム在庫・価格変動監視システムのフロントエンド実装における各ファイルの詳細概要

## 📁 プロジェクト構造

### ルートディレクトリ

| ファイル | 目的 | 重要度 | 説明 |
|---------|------|--------|------|
| `package.json` | 依存関係管理 | 🔴 | Next.js, TanStack Query, Tailwind CSSなど主要ライブラリ定義 |
| `next.config.js` | Next.js設定 | 🟡 | APIプロキシ、環境変数、ビルド設定 |
| `tailwind.config.js` | スタイル設定 | 🟡 | デザインシステム、カラーパレット、レスポンシブ設定 |
| `tsconfig.json` | TypeScript設定 | 🟡 | 型チェック、モジュール解決、コンパイル設定 |

---

## 🎨 UIコンポーネント層

### `/src/components/`

#### **アラート系** (`alerts/`)
- **`LowStockAlert.tsx`** 🔴
  - **機能**: 低在庫商品の警告表示
  - **データソース**: `useLowStockItems` フック
  - **特徴**: リアルタイム更新、在庫レベル表示、アクション可能

#### **ダッシュボード系** (`dashboard/`)
- **`DashboardStats.tsx`** 🔴
  - **機能**: KPI統計カード表示（総商品数、低在庫数、総価値など）
  - **データソース**: `useInventoryStats` フック
  - **特徴**: レスポンシブグリッド、アイコン付きカード、パーセンテージ表示

#### **在庫管理系** (`inventory/`)
- **`InventoryTable.tsx`** 🔴
  - **機能**: 在庫一覧テーブル（ページネーション付き）
  - **データソース**: `useInventoryList` フック
  - **特徴**: ソート可能、フィルタリング、リアルタイム更新

#### **UI共通部品** (`ui/`)
- **`ConnectionStatus.tsx`** 🟡
  - **機能**: WebSocket接続状態の表示
  - **特徴**: 接続/切断ボタン、ステータスインジケータ

- **`ErrorMessage.tsx`** 🟡
  - **機能**: エラー表示用の統一コンポーネント
  - **特徴**: 再試行ボタン、エラー詳細表示

- **`LoadingSpinner.tsx`** 🟢
  - **機能**: ローディング表示
  - **特徴**: サイズ可変、アニメーション

- **`PageHeader.tsx`** 🟢
  - **機能**: ページヘッダー（タイトル、説明文）
  - **特徴**: 階層構造、アクションボタン配置可能

- **`Pagination.tsx`** 🔴
  - **機能**: ページネーション制御
  - **特徴**: ページ移動、件数選択、総件数表示

---

## 🧠 ビジネスロジック層

### `/src/lib/`

#### **APIクライアント** (`api/`)
- **`client.ts`** 🔴
  - **機能**: バックエンドAPI通信の中心
  - **実装**: Axios設定、インターセプター、エラーハンドリング
  - **API群**:
    - `inventoryApi`: 在庫CRUD操作
    - `priceApi`: 価格履歴管理
    - `alertApi`: アラート管理
    - `dashboardApi`: 統計データ取得

- **`types.ts`** 🔴
  - **機能**: TypeScript型定義
  - **定義内容**:
    - `InventoryItem`: 在庫アイテム型
    - `PaginatedResponse<T>`: ページネーション型
    - `WebSocketMessage`: WebSocket通信型
    - `APIError`: エラー型

#### **カスタムフック** (`hooks/`)
- **`use-inventory.ts`** 🔴 **★メインファイル**
  - **機能**: TanStack Query実装の中核
  - **実装パターン**:
    - 階層的キャッシュキー管理
    - 楽観的更新（Optimistic Updates）
    - リアルタイムWebSocket連携
    - 包括的エラーハンドリング
  - **フック一覧**:
    - `useInventoryList`: ページネーション対応一覧取得
    - `useInventoryItem`: 単一アイテム詳細
    - `useLowStockItems`: 低在庫アラート
    - `useCreateInventoryItem`: 新規作成
    - `useUpdateInventoryItem`: 更新（楽観的更新）
    - `useDeleteInventoryItem`: 削除
    - `useInventoryStats`: 統計データ
    - `useInventoryRealTimeUpdates`: WebSocket連携

- **`use-price.ts`** 🟡
  - **機能**: 価格管理フック（将来拡張用）
  - **実装内容**: 価格履歴、変更アラート、リアルタイム価格監視

- **`use-pagination.ts`** 🟡
  - **機能**: ページネーション状態管理
  - **実装**: skip/limit計算、ページ変更処理

- **`use-websocket.ts`** 🟡
  - **機能**: WebSocket接続管理
  - **実装**: 接続制御、メッセージ処理、再接続ロジック

#### **WebSocket通信** (`websocket/`)
- **`client.ts`** 🟡
  - **機能**: WebSocket通信クライアント
  - **特徴**: 自動再接続、メッセージ型安全性、エラーハンドリング

---

## 🎯 アプリケーション層

### `/src/app/`

- **`layout.tsx`** 🔴
  - **機能**: アプリケーション全体のレイアウト
  - **実装**: メタデータ、フォント読み込み、共通スタイル

- **`page.tsx`** 🔴 **★メインページ**
  - **機能**: ダッシュボードメインページ
  - **構成**:
    1. WebSocket接続管理
    2. ページネーション制御
    3. データ取得（在庫、低在庫、統計）
    4. コンポーネント組み立て
  - **レイアウト**:
    - ヘッダー（タイトル + 接続状態）
    - 統計ダッシュボード
    - 低在庫アラート
    - 在庫一覧テーブル

- **`providers.tsx`** 🔴
  - **機能**: TanStack Query設定
  - **実装内容**:
    - QueryClient設定（キャッシュ戦略）
    - グローバルエラーハンドリング
    - 再試行ロジック
    - 開発者ツール統合

- **`globals.css`** 🟢
  - **機能**: グローバルスタイル
  - **内容**: Tailwind CSS基本設定、カスタムクラス

---

## 🔧 技術的実装詳細

### TanStack Query実装パターン

#### 1. **キャッシュ戦略**
```typescript
// 階層的キー構造
inventoryKeys = {
  all: ['inventory'],
  lists: () => [...inventoryKeys.all, 'list'],
  list: (filters) => [...inventoryKeys.lists(), filters],
  detail: (id) => [...inventoryKeys.details(), id],
}
```

#### 2. **楽観的更新**
```typescript
onMutate: async ({ itemId, data }) => {
  // 競合状態防止
  await queryClient.cancelQueries({ queryKey: inventoryKeys.detail(itemId) });
  
  // スナップショット作成
  const previousItem = queryClient.getQueryData(inventoryKeys.detail(itemId));
  
  // 即座にUI更新
  queryClient.setQueryData(inventoryKeys.detail(itemId), newData);
  
  return { previousItem, itemId };
}
```

#### 3. **リアルタイム同期**
```typescript
// WebSocketメッセージでキャッシュ更新
if (data.type === 'inventory_update') {
  queryClient.setQueryData(inventoryKeys.detail(item.id), item);
  queryClient.invalidateQueries({ queryKey: inventoryKeys.lists() });
}
```

### データフロー

```
[WebSocket] ← → [Backend API] ← → [TanStack Query] ← → [React Components]
     ↓                              ↑
[Real-time Updates]            [Cache Management]
```

### エラーハンドリング階層

1. **APIレベル**: Axios インターセプター
2. **クエリレベル**: TanStack Query リトライ
3. **コンポーネントレベル**: エラーバウンダリ
4. **ユーザーレベル**: Toast通知

---

## 📊 パフォーマンス最適化

### キャッシュ戦略
- **StaleTime**: データ鮮度管理（1-5分）
- **GcTime**: メモリ管理（5-30分）
- **RefetchInterval**: 定期更新（2-5分）

### バンドル最適化
- **Code Splitting**: ページ別分割
- **Tree Shaking**: 未使用コード除去
- **Dynamic Import**: 必要時読み込み

---

## 🚀 開発・デプロイメント

### 開発コマンド
```bash
npm run dev        # 開発サーバー起動
npm run build      # 本番ビルド
npm run lint       # コード品質チェック
npm run type-check # 型チェック
```

### 環境設定
- **開発**: http://localhost:3001
- **API**: http://localhost:8000/api/v1
- **WebSocket**: ws://localhost:8000/ws

---

## 📝 型安全性

全ファイルでTypeScript完全対応:
- **API型**: バックエンドスキーマと同期
- **Component Props**: 厳密な型定義
- **Hook Return**: 型推論活用
- **Event Handler**: 型安全なイベント処理

---

## 🔄 リアルタイム機能

### WebSocket統合
1. **接続管理**: 自動再接続、ハートビート
2. **メッセージ処理**: 型安全なデシリアライゼーション
3. **キャッシュ同期**: TanStack Queryとの統合
4. **エラー処理**: 接続断時の適切なフォールバック

この実装により、リアルタイム在庫監視システムとして高いパフォーマンスと保守性を実現しています。